/*
	UIZE JAVASCRIPT FRAMEWORK

	http://www.uize.com/reference/Uize.Build.Wsh.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Build.Wsh',builder:function(){'use strict';var _a=function(){},_b,_c,_d;function _e(_f){return((_f&&_f.fileSystemObject)||_d||(_d=new ActiveXObject('Scripting.FileSystemObject')));}function _g(){return _c||(_c=new ActiveXObject('WScript.Shell'));}var _h=_a.getScriptFolderPath=function(){return WScript.ScriptFullName.slice(0,-WScript.ScriptName.length-1);};var _i=_a.readFile=function(_f){var _d=_e(_f),_j=typeof _f=='string'?_f:_f.path;if(_d.GetFile(_j).Size){var _k=_d.OpenTextFile(_j,1),_l=_k.ReadAll();_k.Close();return _l;}return'';};var _m=_a.writeFile=function(_f){var _j=_f.path,_d=_e(_f);var _n=_j.substr(0,_j.lastIndexOf('\\'));if(!_d.FolderExists(_n)){var _o=_n.split('\\'),_p=_o[0];for(var _q=0,_r=_o.length;++_q<_r;){_p+='\\'+_o[_q];_d.FolderExists(_p)||_d.CreateFolder(_p);}}var _k=_d.CreateTextFile(_j);_k.Write(_f.text);_k.Close();};_a.buildFiles=function(_f){var _s=_f.alwaysBuild,_t=_f.dryRun,_d=_e(_f),_u=WScript.ScriptName,_v=WScript.ScriptFullName,_w=_f.doNotEnter,_x=[];
if(Uize.isArray(_w))_w=new RegExp('\\\\('+_w.join('|')+')(\\W|$)');function _y(_z){return+new Date(_d.GetFile(_z).DateLastModified);}function _A(_n){var _B=_d.getFolder(_n),_C=new Enumerator(_B.SubFolders),_D=_w&&_w.test(_n)?false:_f.targetFolderPathCreator(_n);if(typeof _D=='string'){var _E=new Enumerator(_B.files);while(!_E.atEnd()){var _F=_E.item().Path;if(_F!=_v){var _G=_F.substr(_F.lastIndexOf('\\')+1),_H=_f.targetFilenameCreator(_G);if(_H){var _I=_D+'\\'+_H,_J=_s?'ALWAYS BUILD':(_d.FileExists(_I)?(_y(_F)>_y(_I)?'WAS OUT OF DATE':''):'DIDN\'T EXIST'),_K,_L='';if(_J){var _M=new Date,_N=_f.fileBuilder(_G,_i(_F)),_O=_N.outputText;_L=_N.logDetails||'';!_t&&_O!=_b&&_m({path:_I,text:_O});_K=new Date-_M;}_x.push((_J?'***** ':'')+_F+'\n'+'\tTARGET FILE: '+_I+'\n'+'\t'+(_J?('BUILT ('+_J+'), BUILD DURATION: '+_K+'ms'):'no action, file is current')+'\n'+_L+'\n');}}_E.moveNext();}}if(_D!==false){while(!_C.atEnd()){_A(_C.item().Path);_C.moveNext();}}}_A(_f.rootFolderPath||_h());_m({
path:_f.logFilePath||_u.replace(/\.js$/,'.log'),text:_x.join('')});};_a.execute=function(_P){_g().Run(_P,0,true);};return _a;}});